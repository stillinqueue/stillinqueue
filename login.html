<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Still In Queue Â· Login</title>
  <link rel="icon" type="image/png" href="Fav-Photoroom.png">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-dark: #050815;
      --text-main: #f5f7ff;
      --text-muted: #a7afc9;
      --accent-blue: #3b82f6;
      --accent-yellow: #facc15;
      --accent-green: #22c55e;
      --accent-orange: #fb923c;
      --accent-pink: #ec4899;
      --radius-lg: 1.5rem;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.75);
      --font-sans: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-serif: "Playfair Display", "Times New Roman", serif;
      --transition-fast: 160ms ease-out;
      --transition-med: 260ms ease;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    /* ===== Header & Nav ===== */
    .site-header {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 5vw;
      backdrop-filter: blur(16px);
      background: linear-gradient(
        to bottom,
        rgba(2, 6, 23, 0.95),
        rgba(2, 6, 23, 0.6),
        transparent
      );
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    .logo { display: flex; align-items: center; }
    .logo-img { height: 150px; width: auto; display: block; }

    .header-right { display: flex; align-items: center; gap: 2.5rem; }

    .site-nav {
      display: flex; align-items: center; gap: 2.4rem;
      margin-left: 3rem;
      font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.18em;
    }

    .site-nav a {
      text-decoration: none;
      color: var(--text-muted);
      padding: 0.35rem 0.9rem;
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      background: transparent;
      transition:
        color var(--transition-fast),
        border-color var(--transition-fast),
        background var(--transition-fast),
        box-shadow var(--transition-fast),
        transform var(--transition-fast);
    }

    .site-nav a:not(.active):hover {
      color: #020617;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
      transform: translateY(-1px);
      border-color: rgba(248, 250, 252, 0.9);
    }

    .site-nav a.nav-ai:not(.active):hover { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .site-nav a.nav-learning:not(.active):hover { background: linear-gradient(90deg, #facc15, #fde047); }
    .site-nav a.nav-green:not(.active):hover { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .site-nav a.nav-coffee:not(.active):hover { background: linear-gradient(135deg, #fb923c, #f97316); }
    .site-nav a.nav-about:not(.active):hover { background: linear-gradient(135deg, #ec4899, #a855f7); }

    .site-nav a.active {
      color: #020617;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
      border-color: rgba(248, 250, 252, 0.95);
    }
    .site-nav a.nav-ai.active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .site-nav a.nav-learning.active { background: linear-gradient(90deg, #facc15, #fde047); }
    .site-nav a.nav-green.active { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .site-nav a.nav-coffee.active { background: linear-gradient(135deg, #fb923c, #f97316); }
    .site-nav a.nav-about.active { background: linear-gradient(135deg, #ec4899, #a855f7); }

    .auth-buttons { display: flex; align-items: center; }
    .auth-primary {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      text-decoration: none;
      padding: 0.45rem 1.6rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(248, 250, 252, 0.9);
      background: linear-gradient(135deg, #3b82f6, #22c55e);
      color: #f9fafb;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        box-shadow var(--transition-fast),
        transform var(--transition-fast);
    }

    .auth-primary:hover {
      background: linear-gradient(135deg, #60a5fa, #4ade80);
      border-color: #ffffff;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
    }

    .nav-toggle {
      display: none;
      flex-direction: column;
      gap: 0.2rem;
      background: none;
      border: none;
      cursor: pointer;
    }
    .nav-toggle span { width: 1.5rem; height: 2px; border-radius: 999px; background: #e5e7eb; }

    /* ===== Hero / layout ===== */
    .hero {
      position: relative;
      min-height: calc(100vh - 90px);
      padding: 4rem 5vw 4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      isolation: isolate;
    }

    .hero-bg {
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.55), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(234, 179, 8, 0.45), transparent 60%),
        radial-gradient(circle at 50% 120%, rgba(34, 197, 94, 0.4), transparent 60%);
      opacity: 0.7;
      mix-blend-mode: screen;
      animation: floatGradient 18s ease-in-out infinite alternate;
      z-index: -2;
    }

    @keyframes floatGradient {
      0%   { transform: translate3d(0, 0, 0) scale(1); }
      50%  { transform: translate3d(0, -4%, 0) scale(1.05); }
      100% { transform: translate3d(0, 3%, 0) scale(1.02); }
    }

    .hero-shell { display: none; }

    .auth-card {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: row;
      gap: 2rem;
      padding: 2.5rem;
      border-radius: 1.8rem;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.75);
      max-width: 1080px;
      width: 100%;
    }

    .auth-left {
      flex: 1.1;
      padding-right: 1.6rem;
      border-right: 1px solid rgba(148, 163, 184, 0.35);
    }

    .auth-right {
      flex: 0.9;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-left: 1.6rem;
    }

    @media (max-width: 880px) {
      .auth-card {
        flex-direction: column;
        padding: 2rem 1.5rem;
      }
      .auth-left {
        border-right: none;
        padding-right: 0;
        padding-bottom: 1.6rem;
        border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      }
      .auth-right { padding-left: 0; }
      .hero {
        padding-inline: 1.5rem;
      }
    }

    /* Branding text */
    .app-title {
      font-size: 0.9rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #71c9f8;
      margin-bottom: 0.4rem;
    }

    .app-heading {
      font-family: var(--font-serif);
      font-size: 1.9rem;
      font-weight: 700;
      line-height: 1.25;
      margin-bottom: 0.35rem;
    }

    .app-subtitle {
      font-size: 0.95rem;
      color: rgba(225, 232, 255, 0.78);
      margin-bottom: 1.1rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.6rem;
    }

    .pill {
      font-size: 0.75rem;
      padding: 0.25rem 0.7rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: rgba(214, 226, 255, 0.9);
    }

    /* Form */
    .form-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 1.2rem;
    }

    .form-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .toggle-text {
      font-size: 0.85rem;
      color: rgba(214, 226, 255, 0.8);
    }

    .toggle-text button {
      background: none;
      border: none;
      color: #71c9f8;
      font: inherit;
      cursor: pointer;
      padding: 0;
      text-decoration: underline;
      text-decoration-style: dotted;
    }

    .form-group { margin-bottom: 1rem; }

    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.35rem;
      color: rgba(214, 226, 255, 0.9);
    }

    .input-wrapper { position: relative; }

    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 0.7rem 0.9rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(117, 150, 255, 0.5);
      outline: none;
      background: rgba(10, 16, 39, 0.9);
      color: #f5f7ff;
      font-size: 0.95rem;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input::placeholder { color: rgba(192, 205, 255, 0.6); }

    input:focus {
      border-color: #71c9f8;
      box-shadow: 0 0 0 1px rgba(113, 201, 248, 0.3);
      background: rgba(15, 24, 60, 0.98);
    }

    .small-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
      font-size: 0.78rem;
      color: rgba(196, 208, 242, 0.8);
    }

    .small-row a {
      color: #71c9f8;
      text-decoration: none;
    }

    .small-row a:hover { text-decoration: underline; }

    .btn-primary {
      width: 100%;
      padding: 0.8rem 1rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      background: linear-gradient(135deg, #3b82f6, #22c55e, #facc15);
      color: #051326;
      box-shadow: 0 14px 32px rgba(56, 155, 238, 0.55);
      margin-bottom: 0.75rem;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.75);
    }

    .help-text {
      font-size: 0.75rem;
      color: rgba(182, 196, 236, 0.9);
    }

    /* ===== Companions image + overlays ===== */
    .characters-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .characters-title {
      font-size: 0.9rem;
      color: rgba(214, 226, 255, 0.85);
      margin-bottom: 0.3rem;
    }

    .companions-card {
      border-radius: 1.4rem;
      background: radial-gradient(circle at top, rgba(9, 33, 70, 0.96), rgba(3, 7, 18, 0.98));
      border: 1px solid rgba(114, 163, 255, 0.45);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
      padding: 0.9rem;
    }

    .companions-image-wrapper {
      position: relative;
      width: 100%;
      max-width: 360px;
      margin: 0 auto;
    }

    .companions-img {
      width: 100%;
      display: block;
      border-radius: 1.2rem;
    }

    .eyes,
    .mouth {
      position: absolute;
      transform: translate(-50%, -50%);
    }

    .eyes {
      display: flex;
      gap: 4px;
      z-index: 3;
    }

    /* FINAL alignment values */

    /* Yellow book */
    .eyes-book   { top: 75%; left: 19%; }
    .mouth-book  { top: 84%; left: 21%; }

    /* Red blob */
    .eyes-blob   { top: 62%; left: 42%; }
    .mouth-blob  { top: 74%; left: 44%; }

    /* Green sun */
    .eyes-sun    { top: 27%; left: 63%; }
    .mouth-sun   { top: 37%; left: 65%; }

    /* Blue cloud */
    .eyes-cloud  { top: 70%; left: 69%; }
    .mouth-cloud { top: 79%; left: 71%; }

    /* Eye + pupil styling */
    .eye {
      width: 16px;
      height: 16px;
      background: #fdfdfd;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(25, 37, 71, 0.7);
    }

    .pupil {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #111827;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.06s linear;
    }

    /* ===== Mouth sprite (sq-mouths.png, 2x2 grid) ===== */
    .mouth {
      width: 64px;                 /* adjust if needed to match sprite */
      height: 48px;
      background-image: url("sq-mouths.png");
      background-size: 200% 200%;  /* 2 x 2 grid */
      background-repeat: no-repeat;
      z-index: 3;
      opacity: 1;
    }

    /* top-left = normal, top-right = big grin,
       bottom-left = O, bottom-right = (unused/ignored) */

    .characters-wrapper.mouth-smile .mouth {
      background-position: 0% 0%;          /* normal */
      opacity: 1;
    }

    .characters-wrapper.mouth-happy .mouth {
      background-position: 100% 0%;        /* big grin */
      opacity: 1;
    }

    .characters-wrapper.mouth-surprised .mouth {
      background-position: 0% 100%;        /* bottom-left frame */
      opacity: 1;
      /* extra offset ONLY for password / surprised state */
      transform: translate(-50%, -50%) translate(1px, 9px);
    }

    /* ignore 4th sprite frame: map slash to surprised as backup */
    .characters-wrapper.mouth-slash .mouth {
      background-position: 0% 100%;
      opacity: 1;
    }

    .characters-wrapper.mouth-none .mouth {
      opacity: 0;
    }

    .characters-wrapper.happy .eye {
      transform: scale(1.1);
    }

    .characters-wrapper.happy .companions-card {
      box-shadow: 0 22px 60px rgba(87, 186, 255, 0.95);
      border-color: rgba(120, 211, 255, 0.9);
    }

    .characters-wrapper.signup-mode .companions-card {
      box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.6), 0 0 30px rgba(250, 204, 21, 0.4);
    }

    .characters-footer {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: rgba(182, 196, 236, 0.9);
    }
    .characters-footer strong { color: #71c9f8; }

    @media (max-width: 768px) {
      .site-header { padding-inline: 1.25rem; }
      .header-right { gap: 1.4rem; }
      .nav-toggle { display: inline-flex; }
      .site-nav {
        position: absolute; top: 100%; right: 0; flex-direction: column; align-items: flex-start;
        width: min(260px, 80vw); padding: 0.75rem 1rem 1rem; margin-left: 0;
        background: rgba(15, 23, 42, 0.98);
        border-radius: 0 0 1.5rem 1.5rem;
        border-left: 1px solid rgba(148, 163, 184, 0.3);
        border-bottom: 1px solid rgba(148, 163, 184, 0.3);
        transform-origin: top right; transform: scaleY(0.8);
        opacity: 0; visibility: hidden;
        transition: opacity var(--transition-fast), transform var(--transition-fast), visibility var(--transition-fast);
      }
      .site-nav.nav-open { opacity: 1; visibility: visible; transform: scaleY(1); }
      .site-nav a { width: 100%; padding: 0.5rem 0.4rem; }
      .auth-buttons { display: none; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <a href="index.html" class="logo">
      <img src="SQ-Group-Photoroom.png" alt="Still In Queue Group" class="logo-img" />
    </a>

    <button class="nav-toggle" aria-label="Toggle navigation">
      <span></span><span></span>
    </button>

    <div class="header-right">
      <nav class="site-nav">
        <a href="index.html#pillars" class="nav-ai">Artificial Intelligence</a>
        <a href="index.html#pillars" class="nav-learning">Learning Platform</a>
        <a href="index.html#pillars" class="nav-green">Green Energy</a>
        <a href="index.html#pillars" class="nav-coffee">Coffee-Cream</a>
        <a href="index.html#about" class="nav-about">About</a>
      </nav>

      <div class="auth-buttons">
        <a href="#auth" class="auth-primary">Login / Sign Up</a>
      </div>
    </div>
  </header>

  <!-- Sparkle canvas -->
  <canvas id="sparkle-canvas" aria-hidden="true"></canvas>

  <main id="auth" class="hero">
    <div class="hero-bg"></div>
    <div class="hero-shell"></div>

    <div class="auth-card">
      <!-- LEFT: auth -->
      <div class="auth-left">
        <div class="app-title">Still In Queue Â· Unified Login</div>
        <h1 class="app-heading">Welcome back to your SQ ecosystem</h1>
        <p class="app-subtitle">
          One account for your <strong>SQ-AI Agents</strong>, <strong>Learning Platform</strong>,
          <strong>Green Energy</strong> planning, and <strong>Coffee &amp; Cream</strong> experiences.
        </p>

        <div class="pill-row">
          <div class="pill">SQ Â· AI Workflows</div>
          <div class="pill">SQ Â· Learning</div>
          <div class="pill">SQ Â· Green Energy</div>
          <div class="pill">SQ Â· Creme &amp; Coffee</div>
        </div>

        <div class="form-title-row">
          <div class="form-title" id="formTitle">Log in</div>
          <div class="toggle-text">
            <span id="toggleLabel">New here?</span>
            <button id="toggleModeBtn" type="button">Create account</button>
          </div>
        </div>

        <form id="authForm" autocomplete="off">
          <div class="form-group" id="nameGroup" style="display:none;">
            <label for="name">Full name</label>
            <div class="input-wrapper">
              <input type="text" id="name" name="name" placeholder="How should we call you?" autocomplete="off" />
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <div class="input-wrapper">
              <input type="email" id="email" name="email" placeholder="you@stillinqueue.com" autocomplete="off" required />
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-wrapper">
              <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off" required />
            </div>
          </div>

          <div class="small-row">
            <label>
              <input type="checkbox" id="remember" />
              Remember me on this device
            </label>
            <a href="#" id="forgotLink">Forgot password?</a>
          </div>

          <button type="submit" class="btn-primary">Continue</button>

          <p class="help-text">
            By continuing you agree that your SQ companions will cheer when you type your
            email and politely go ðŸ˜® O while you type your password.
          </p>
        </form>
      </div>

      <!-- RIGHT: companions image + eyes/mouth overlays -->
      <div class="auth-right">
        <div class="characters-wrapper mouth-smile" id="charactersWrapper">
          <div class="characters-title">
            Your four-fold companions react as you move and type âœ¨
          </div>

          <div class="companions-card">
            <div class="companions-image-wrapper">
              <img src="sq-companions-Photoroom.png" alt="SQ companions" class="companions-img">

              <!-- Yellow book -->
              <div class="eyes eyes-book">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
              </div>
              <div class="mouth mouth-book"></div>

              <!-- Red blob -->
              <div class="eyes eyes-blob">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
              </div>
              <div class="mouth mouth-blob"></div>

              <!-- Green sun -->
              <div class="eyes eyes-sun">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
              </div>
              <div class="mouth mouth-sun"></div>

              <!-- Blue cloud -->
              <div class="eyes eyes-cloud">
                <div class="eye"><div class="pupil"></div></div>
                <div class="eye"><div class="pupil"></div></div>
              </div>
              <div class="mouth mouth-cloud"></div>
            </div>
          </div>

          <div class="characters-footer">
            Email â†’ <strong>happy</strong> Â· Password â†’ <strong>O + look away</strong> Â· Forgot? â†’ <strong>O but watching you ðŸ‘€</strong>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Nav JS (mobile) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.querySelector(".nav-toggle");
      const nav = document.querySelector(".site-nav");
      const navLinks = document.querySelectorAll(".site-nav a");

      if (toggle && nav) {
        toggle.addEventListener("click", () => {
          nav.classList.toggle("nav-open");
        });
      }

      navLinks.forEach((link) => {
        const href = link.getAttribute("href") || "";
        if (!href) return;

        if (href.startsWith("#")) {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) target.scrollIntoView({ behavior: "smooth" });

            navLinks.forEach((l) => l.classList.remove("active"));
            link.addEventListener("click", () => {});
            link.classList.add("active");
            if (nav) nav.classList.remove("nav-open");
          });
        } else {
          link.addEventListener("click", () => {
            if (nav) nav.classList.remove("nav-open");
          });
        }
      });
    });
  </script>

  <!-- Characters behaviour (UPDATED) -->
  <script>
    (function () {
      const wrapper = document.getElementById("charactersWrapper");
      if (!wrapper) return;

      const pupils = Array.from(document.querySelectorAll(".pupil"));
      const maxOffset = 5;

      // store last mouse position so we can reuse it when gaze mode changes
      let lastMouse = {
        x: window.innerWidth / 2,
        y: window.innerHeight / 2
      };

      function updatePupils(mouseX, mouseY) {
        const reverse = wrapper.classList.contains("reverse-gaze") ? -1 : 1;

        pupils.forEach((p) => {
          const eye = p.parentElement.getBoundingClientRect();
          const cx = eye.left + eye.width / 2;
          const cy = eye.top + eye.height / 2;

          const dx = mouseX - cx;
          const dy = mouseY - cy;
          const dist = Math.max(1, Math.hypot(dx, dy));
          const nx = dx / dist;
          const ny = dy / dist;

          const offsetX = nx * maxOffset * reverse;
          const offsetY = ny * maxOffset * reverse;

          p.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
        });
      }

      function applyCurrentGaze() {
        updatePupils(lastMouse.x, lastMouse.y);
      }

      document.addEventListener("mousemove", (e) => {
        lastMouse.x = e.clientX;
        lastMouse.y = e.clientY;
        updatePupils(lastMouse.x, lastMouse.y);
      });

      function setMouthMode(mode) {
        const modes = ["mouth-smile", "mouth-happy", "mouth-surprised", "mouth-slash", "mouth-none"];
        modes.forEach((m) => wrapper.classList.remove(m));
        if (mode) wrapper.classList.add(mode);
      }

      window.SQCharacters = {
        setHappy(on) {
          wrapper.classList.toggle("happy", !!on);
        },
        setReverseGaze(on) {
          wrapper.classList.toggle("reverse-gaze", !!on);
          // immediately recompute gaze based on current mouse position
          applyCurrentGaze();
        },
        setSignupGlow(on) {
          wrapper.classList.toggle("signup-mode", !!on);
        },
        setMouth(mode) {
          let cls = "mouth-smile";
          if (mode === "happy") cls = "mouth-happy";
          else if (mode === "surprised") cls = "mouth-surprised";
          else if (mode === "slash") cls = "mouth-slash";
          else if (mode === "none") cls = "mouth-none";
          setMouthMode(cls);
        },
        applyCurrentGaze
      };

      window.SQCharacters.setMouth("smile");
      // initial gaze application (for initial mouse position)
      applyCurrentGaze();
    })();
  </script>

  <!-- Characters focus / mode logic -->
  <script>
    (function () {
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const toggleBtn = document.getElementById("toggleModeBtn");
      const formTitle = document.getElementById("formTitle");
      const toggleLabel = document.getElementById("toggleLabel");
      const nameGroup = document.getElementById("nameGroup");
      const forgotLink = document.getElementById("forgotLink");

      let isSignup = false;

      emailInput.addEventListener("focus", () => {
        window.SQCharacters.setReverseGaze(false);
        window.SQCharacters.setHappy(true);
        window.SQCharacters.setMouth("happy");
      });

      emailInput.addEventListener("input", () => {
        window.SQCharacters.setHappy(true);
        window.SQCharacters.setMouth("happy");
      });

      emailInput.addEventListener("blur", () => {
        window.SQCharacters.setHappy(false);
        window.SQCharacters.setReverseGaze(false);
        window.SQCharacters.setMouth("smile");
      });

      passwordInput.addEventListener("focus", () => {
        window.SQCharacters.setHappy(false);
        window.SQCharacters.setReverseGaze(true);      // look away instantly now
        window.SQCharacters.setMouth("surprised");     // O-mouth
      });

      passwordInput.addEventListener("blur", () => {
        window.SQCharacters.setReverseGaze(false);
        window.SQCharacters.setMouth("smile");
      });

      // Forgot password hover: same O mouth, but eyes back to cursor
      forgotLink.addEventListener("mouseenter", () => {
        window.SQCharacters.setReverseGaze(false);     // look towards cursor
        window.SQCharacters.setMouth("surprised");
      });

      forgotLink.addEventListener("mouseleave", () => {
        // If password is focused, restore password expression
        if (document.activeElement === passwordInput) {
          window.SQCharacters.setReverseGaze(true);
          window.SQCharacters.setMouth("surprised");
        } else if (document.activeElement === emailInput) {
          window.SQCharacters.setReverseGaze(false);
          window.SQCharacters.setMouth("happy");
        } else {
          window.SQCharacters.setReverseGaze(false);
          window.SQCharacters.setMouth("smile");
        }
      });

      toggleBtn.addEventListener("click", () => {
        isSignup = !isSignup;
        if (isSignup) {
          formTitle.textContent = "Create account";
          toggleLabel.textContent = "Already have an account?";
          toggleBtn.textContent = "Log in";
          nameGroup.style.display = "block";
          window.SQCharacters.setSignupGlow(true);
        } else {
          formTitle.textContent = "Log in";
          toggleLabel.textContent = "New here?";
          toggleBtn.textContent = "Create account";
          nameGroup.style.display = "none";
          window.SQCharacters.setSignupGlow(false);
        }
      });

      document.getElementById("authForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const btn = this.querySelector(".btn-primary");
        btn.textContent = "Queued âœ”";
        window.SQCharacters.setMouth("none");
        setTimeout(() => {
          window.SQCharacters.setMouth("smile");
          btn.textContent = "Continue";
        }, 1200);
      });
    })();
  </script>

  <!-- Sparkle trail -->
  <script>
  (() => {
    const HONOR_REDUCED_MOTION = false;
    if (document.documentElement.dataset.sparkles === 'off') return;
    if (HONOR_REDUCED_MOTION && matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    const canvas = document.getElementById('sparkle-canvas');
    const ctx = canvas.getContext('2d', { alpha: true });
    Object.assign(canvas.style, {
      mixBlendMode: 'screen',
      willChange: 'transform',
      pointerEvents: 'none',
      position: 'fixed',
      inset: '0',
      zIndex: '50',
      width: '100%',
      height: '100%'
    });

    const state = { w: 0, h: 0, dpr: Math.min(2, Math.max(1, window.devicePixelRatio || 1)) };
    function resize() {
      state.w = canvas.clientWidth | 0;
      state.h = canvas.clientHeight | 0;
      canvas.width  = Math.max(1, state.w * state.dpr);
      canvas.height = Math.max(1, state.h * state.dpr);
      ctx.setTransform(state.dpr, 0, 0, state.dpr, 0, 0);
    }
    resize();
    addEventListener('resize', resize);

    const COLORS        = ['#3b82f6', '#22c55e', '#facc15', '#fb923c'];
    const SILVER        = '#e5e7eb';

    const STEP          = 4;
    const PER_STEP      = 4;
    const POS_JIT       = 12;
    const POS_JIT_PCT   = 0.40;

    const LIFE_MIN      = 900;
    const LIFE_VAR      = 600;
    const FRICTION      = 0.992;
    const GRAVITY       = 0.007;
    const SPEED_JIT     = 1.0;
    const NOISE         = 0.035;

    const STAR_CHANCE   = 0.08;
    const STAR_SCALES   = [0.9, 1.15, 1.4, 2.3];

    const IDLE_DELAY_MS = 120;
    const IDLE_EVERY_MS = 55;
    const IDLE_COUNT    = 2;
    const IDLE_SPREAD   = 18;
    const IDLE_SPEED    = 0.5;

    const MAX           = 620;

    const P = new Array(MAX).fill(null);
    let head = 0;
    function addParticle(x, y, vx, vy, color, type='dot', extra={}) {
      const life = LIFE_MIN + Math.random()*LIFE_VAR;
      const base = (type === 'dot') ? (1.2 + Math.random()*2.6) : (1.0 + Math.random()*1.5);
      const rot  = Math.random() * Math.PI * 2;
      const starScale = (type === 'star') ? STAR_SCALES[(Math.random()*STAR_SCALES.length)|0] : 1;
      P[head] = { x, y, vx, vy, life, ttl: life, base, color, type, rot, starScale, ...extra };
      head = (head + 1) % MAX;
    }

    const hexA = (hex, a) => {
      const n = hex.replace('#','');
      const v = parseInt(n.length===3 ? n.split('').map(c=>c+c).join('') : n, 16);
      const r=(v>>16)&255,g=(v>>8)&255,b=v&255;
      return `rgba(${r},${g},${b},${a})`;
    };

    function drawBubble(x, y, r, color, alpha) {
      const g = ctx.createRadialGradient(x, y, 0, x, y, r);
      g.addColorStop(0.00, hexA(color, Math.min(1, alpha*0.85)));
      g.addColorStop(0.50, hexA(color, Math.min(1, alpha*0.35)));
      g.addColorStop(1.00, hexA(color, 0));
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI*2);
      ctx.fill();
    }

    function drawStar5(x, y, outerR, alpha) {
      const innerR = outerR * 0.5;
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(-Math.PI/2);
      ctx.beginPath();
      for (let i=0; i<5; i++) {
        const a0 = (i * 2 * Math.PI) / 5;
        const a1 = a0 + Math.PI / 5;
        ctx.lineTo(Math.cos(a0)*outerR, Math.sin(a0)*outerR);
        ctx.lineTo(Math.cos(a1)*innerR, Math.sin(a1)*innerR);
      }
      ctx.closePath();
      ctx.fillStyle = hexA(SILVER, alpha);
      ctx.shadowColor = SILVER;
      ctx.shadowBlur = 14;
      ctx.fill();
      ctx.restore();
    }

    function spawnAt(x, y, segLen, pressed) {
      const now = performance.now();
      const baseIndex = Math.floor(now/140) % COLORS.length;
      const count = PER_STEP + (pressed ? 1 : 0);
      const jitterR = POS_JIT + segLen * POS_JIT_PCT;

      for (let i=0; i<count; i++) {
        const angPos = Math.random()*Math.PI*2;
        const jx = Math.cos(angPos) * (Math.random() * jitterR);
        const jy = Math.sin(angPos) * (Math.random() * jitterR);

        const angVel = Math.random()*Math.PI*2;
        const pow = Math.random()*SPEED_JIT;
        const vx = Math.cos(angVel)*pow;
        const vy = Math.sin(angVel)*pow - 0.02;

        const color = COLORS[(baseIndex + i) % COLORS.length];
        addParticle(x + jx, y + jy, vx, vy, color, 'dot');
      }

      if (Math.random() < STAR_CHANCE) {
        const angVel = Math.random()*Math.PI*2;
        const vx = Math.cos(angVel) * 0.28;
        const vy = Math.sin(angVel) * 0.28 - 0.05;
        addParticle(x, y, vx, vy, SILVER, 'star');
      }
    }

    function sampleSpawns(x0, y0, x1, y1, pressed) {
      if (x0 == null || y0 == null) { spawnAt(x1, y1, STEP, pressed); return; }
      const dx = x1 - x0, dy = y1 - y0;
      const dist  = Math.hypot(dx, dy);
      const steps = Math.max(1, Math.floor(dist / STEP));
      const segLen = dist / steps;
      for (let s=1; s<=steps; s++) {
        const t = s / steps;
        spawnAt(x0 + dx*t, y0 + dy*t, segLen, pressed);
      }
    }

    let last = null, down = false;
    let lastMoveAt = performance.now();
    let idleAcc = 0;

    addEventListener('pointerdown', e => {
      down = true;
      last = { x: e.clientX, y: e.clientY };
      lastMoveAt = performance.now();
      spawnAt(e.clientX, e.clientY, STEP, true);
    }, { passive: true });

    addEventListener('pointerup',   () => { down = false; last = null; }, { passive: true });

    addEventListener('pointermove', e => {
      const list = (typeof e.getCoalescedEvents === 'function') ? e.getCoalescedEvents() : null;
      if (list && list.length) {
        for (const ev of list) {
          if (last) sampleSpawns(last.x, last.y, ev.clientX, ev.clientY, down);
          else spawnAt(ev.clientX, ev.clientY, STEP, down);
          last = { x: ev.clientX, y: ev.clientY };
        }
      } else {
        const x = e.clientX, y = e.clientY;
        if (last) sampleSpawns(last.x, last.y, x, y, down);
        else spawnAt(x, y, STEP, down);
        last = { x, y };
      }
      lastMoveAt = performance.now();
    }, { passive: true });

    function idleEmit(dt) {
      if (!last) return;
      const since = performance.now() - lastMoveAt;
      if (since < IDLE_DELAY_MS) { idleAcc = 0; return; }
      idleAcc += dt;
      while (idleAcc >= IDLE_EVERY_MS) {
        idleAcc -= IDLE_EVERY_MS;
        for (let i=0; i<IDLE_COUNT; i++) {
          const ang = Math.random() * Math.PI * 2;
          const r   = Math.random() * IDLE_SPREAD;
          const x = last.x + Math.cos(ang) * r;
          const y = last.y + Math.sin(ang) * r;
          const vang = Math.random() * Math.PI * 2;
          const vpow = Math.random() * IDLE_SPEED;
          const vx = Math.cos(vang) * vpow;
          const vy = Math.sin(vang) * vpow - 0.02;
          const color = COLORS[(Math.floor(performance.now()/180)) % COLORS.length];
          addParticle(x, y, vx, vy, color, 'dot');
        }
        if (Math.random() < 0.12) {
          const vx = (Math.random()-0.5) * 0.3;
          const vy = (Math.random()-0.8) * 0.3;
          addParticle(last.x, last.y, vx, vy, SILVER, 'star');
        }
      }
    }

    let lastFrame = performance.now();
    function tick(now) {
      const dt = now - lastFrame;
      lastFrame = now;

      ctx.clearRect(0, 0, state.w, state.h);
      idleEmit(dt);

      for (let i=0; i<MAX; i++) {
        const p = P[i];
        if (!p || p.ttl <= 0) continue;

        p.vx += (Math.random()-0.5) * NOISE;
        p.vy += (Math.random()-0.5) * NOISE;

        p.vx *= FRICTION;
        p.vy = p.vy * FRICTION + GRAVITY;
        p.x += p.vx;
        p.y += p.vy;

        p.ttl -= dt;
        const t = Math.max(0, p.ttl / p.life);
        const alpha = t;
        const r = p.base * (0.7 + 1.8*(1 - t));

        if (p.type === 'dot') {
          drawBubble(p.x, p.y, r, p.color, alpha);
        } else {
          drawStar5(p.x, p.y, r * p.starScale, Math.min(1, alpha*0.9));
        }
      }

      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    document.addEventListener('visibilitychange', () => { lastFrame = performance.now(); });
  })();
  </script>
</body>
</html>
